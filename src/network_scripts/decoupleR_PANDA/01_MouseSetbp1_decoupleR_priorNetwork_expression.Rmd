---
title: "01_MouseSetbp1_decoupleR_priorNetwork_expression"
author: "Jordan Whitlock"
date: '2023-05-11'
output: html_document
---
#note for reviewer (reviewer 2 can remoce this line): this was run in docker 1.0.5

This script is used in order to generate expression inputs for construction of the prior network (in this case PANDA networks for each condition across both tissues) required for decoupleR. this script is succeeded by 01_array_construction and 02_PANDA_array for construction of decoupleR PANDA networks for each cell type in cortex and kidney.

```{r load-libraries-setup}
ptm <- proc.time()
set.seed(2178)
library(Seurat)
library(here)
library(styler)
library(lintr)
```

```{r load-seurat-objects}
# cerebral cortex data:
load(here("data/setbp1_cerebralintcelltypes.Rdata")) # cerebral_int_celltypes

# kidney data:
load(here("data/kidney_integrated_celltypes_postSoup.Rdata")) # kidney_int_celltypes
```

```{r split-object-by-condition}
cerebral_split <- SplitObject(cerebral_int_celltypes, split.by = "type")

kidney_split <- SplitObject(kidney_int_celltypes, split.by = "type")
```

```{r extract-expression-inputs}
# heterozygous
cerebral_het_counts <- as.data.frame(cerebral_split$heterozygous@assays$RNA@data)
save(cerebral_het_counts, file = here("data/processed/decoupleR_PANDA_expression_inputs/cerebral_het.Rdata"))

kidney_het_counts <- as.data.frame(kidney_split$heterozygous@assays$RNA@data)
save(kidney_het_counts, file = here("data/processed/decoupleR_PANDA_expression_inputs/kidney_het.Rdata"))

# control
cerebral_ctrl_counts <- as.data.frame(cerebral_split$control@assays$RNA@data)
save(cerebral_ctrl_counts, file = here("data/processed/decoupleR_PANDA_expression_inputs/cerebral_ctrl.Rdata"))

kidney_ctrl_counts <- as.data.frame(kidney_split$control@assays$RNA@data)
save(kidney_ctrl_counts, file = here("data/processed/decoupleR_PANDA_expression_inputs/kidney_ctrl.Rdata"))
```

```{r time-tracking}
fptm <- proc.time() - ptm

# convert to minutes
(fptm[3] / 60)
```
elapsed
4.100717

```{r}
style_file(here("src/network_scripts/input_construction/06_MouseSetbp1_decoupleR_priorNetwork_expression.Rmd"))
```


```{r}
sessionInfo()
```

R version 4.1.3 (2022-03-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
[1] C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] lintr_3.0.2        styler_1.9.0       here_1.0.1         SeuratObject_4.1.3 Seurat_4.3.0      

loaded via a namespace (and not attached):
  [1] Rtsne_0.16             colorspace_2.1-0       deldir_1.0-6           ellipsis_0.3.2         ggridges_0.5.4         rprojroot_2.0.3       
  [7] rstudioapi_0.14        spatstat.data_3.0-0    leiden_0.4.3           listenv_0.9.0          remotes_2.4.2          ggrepel_0.9.3         
 [13] fansi_1.0.4            xml2_1.3.3             codetools_0.2-18       splines_4.1.3          R.methodsS3_1.8.2      knitr_1.42            
 [19] polyclip_1.10-4        jsonlite_1.8.4         ica_1.0-3              cluster_2.1.2          png_0.1-8              R.oo_1.25.0           
 [25] uwot_0.1.14            shiny_1.7.4            sctransform_0.3.5      spatstat.sparse_3.0-0  compiler_4.1.3         httr_1.4.5            
 [31] Matrix_1.5-3           fastmap_1.1.1          lazyeval_0.2.2         cli_3.6.0              later_1.3.0            htmltools_0.5.4       
 [37] tools_4.1.3            igraph_1.4.1           gtable_0.3.1           glue_1.6.2             RANN_2.6.1             reshape2_1.4.4        
 [43] dplyr_1.1.0            Rcpp_1.0.10            scattermore_0.8        vctrs_0.5.2            spatstat.explore_3.0-6 nlme_3.1-155          
 [49] progressr_0.13.0       lmtest_0.9-40          spatstat.random_3.1-3  xfun_0.37              stringr_1.5.0          ps_1.7.2              
 [55] globals_0.16.2         mime_0.12              miniUI_0.1.1.1         lifecycle_1.0.3        irlba_2.3.5.1          goftest_1.2-3         
 [61] future_1.31.0          MASS_7.3-55            zoo_1.8-11             scales_1.2.1           promises_1.2.0.1       spatstat.utils_3.0-1  
 [67] rex_1.2.1              parallel_4.1.3         RColorBrewer_1.1-3     yaml_2.3.7             reticulate_1.28        pbapply_1.7-0         
 [73] gridExtra_2.3          ggplot2_3.4.1          stringi_1.7.12         desc_1.4.2             cyclocomp_1.1.0        rlang_1.0.6           
 [79] pkgconfig_2.0.3        matrixStats_0.63.0     evaluate_0.20          lattice_0.20-45        ROCR_1.0-11            purrr_1.0.1           
 [85] tensor_1.5             patchwork_1.1.2        htmlwidgets_1.6.1      processx_3.8.0         cowplot_1.1.1          tidyselect_1.2.0      
 [91] parallelly_1.34.0      RcppAnnoy_0.0.20       plyr_1.8.8             magrittr_2.0.3         R6_2.5.1               generics_0.1.3        
 [97] withr_2.5.0            pillar_1.8.1           fitdistrplus_1.1-8     survival_3.3-1         abind_1.4-5            sp_1.6-0              
[103] tibble_3.1.8           future.apply_1.10.0    crayon_1.5.2           KernSmooth_2.23-20     utf8_1.2.3             spatstat.geom_3.0-6   
[109] plotly_4.10.1          rmarkdown_2.20         grid_4.1.3             data.table_1.14.8      callr_3.7.3            digest_0.6.31         
[115] xtable_1.8-4           R.cache_0.16.0         tidyr_1.3.0            httpuv_1.6.9           R.utils_2.12.2         munsell_0.5.0         
[121] viridisLite_0.4.1     
