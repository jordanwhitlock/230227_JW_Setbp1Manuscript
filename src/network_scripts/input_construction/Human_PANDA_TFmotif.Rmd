---
title: "Human_PANDA_TFmotif"
output: html_document
date: '2022-11-15'
---

# Generating own CIS-BP Tf-Motif input:

* Grabbing TF-Motif Input for Mus Musculus (Mouse):
  * Accessed 221115 from Kimberly Glass Resources "PANDA-ready Motif Mappings" (https://sites.google.com/a/channing.harvard.edu/kimberlyglass/tools/resources)
  * The resource contains a Human Motif Scan (file name: Homo_sapiens_motifinfo.txt) for hg38 here that contains the TF and its MOTIF ID: https://drive.google.com/file/d/1MlPiAmOxu4mTd4nW9zMygzK1U9F8XB0M/view
  * Additionally a Prior Network (file name: hg38_reseq_-750_250_1e-4.txt) is provided that contains MOTIF IDs and the gene that they bind to here: https://drive.google.com/file/d/1Wmw64hZOIoIrdeE2XjUulmbFp2RArcFa/view
  * How motif mapping was generated by Glass: The mappings were produced by using FIMO to scan a genome for sets of  CIS-BP Single Species DNA-motifs curated in the MEME suite. Hits that met a significance less than 1e-4 were recorded and mapped to genes based on annotations downloaded from UCSC. Significant motif hits that fell within [-750,+250] of a gene's transcriptional start site were used to construct a prior regulatory network. 

* Accompanying dry lab notebook for this analysis is here: https://docs.google.com/document/d/1FO_Je9oxbBFF9S_k-8tVF2t4ba88O4C77sw1v7DIFec/edit?usp=sharing

Note: The TF Motif input is needed in order to construct string PPI inputs for the network analysis. This script precedes the Human_PANDA_ppi.Rmd and the output generated here is needed as an input for that analysis. 

## Code: 

Load in libraries needed:
```{r}
library(stringr)
library(dplyr)
library(here)
library(styler)
library(lintr)
```


Programatically read the .txt files into R (see notes and script in accompanying dry lab notebook referenced above). Need to map the MOTIF IDs in the prior network and their corresponding genes to the MOTIF IDs in the Mouse Motif Scan to create a final input dataset that contains the following columns: "gene", "TF", "1/0" where the 1 indicates the releationship being present (final input dataset should be all 1's)

```{r}
# load in the data from Glass Resource:
human_motif <- read.table(here("data/unprocessed/Homo_sapiens_motifinfo.txt"), header = TRUE) # has column headers
prior_network <- read.table(here("data/unprocessed/hg38_refseq_-750_250_1e-4.txt")) # does not have column headers
```

### Clean up mouse_motif input data:
```{r}
# remove the version numbers on Motif IDs from MotifID column:
MotifIDs <- str_split(human_motif$MotifID, "\\_", simplify = TRUE)[, 1] # grab list of IDs without version
human_motif$MotifID <- MotifIDs # set list of cleaned up IDs and MotifID column values

# remove parantheses and other characters from TF info so that TF only contains name of TF:
TFs <- str_split(human_motif$TF_Info, "\\_", simplify = TRUE)[, 1] # splits every column value out by separator and only grabs the gene names
TFs <- gsub("[()]", "", TFs) # removes genes from ()
human_motif$TF_Info <- TFs
dim(human_motif) # 733 total TFs, 2 columns 1 for TF_Info and 1 for MotifID. NOTE: there are three unknown genes that do not have a gene symbol (ENSG00000250542, ENSG00000235187, ENSG00000229544), may need to remove later if cause issues in network construction
```

### Add column names to prior network for mapping:
```{r}
colnames(prior_network) <- c("MotifID", "Motif", "interaction")
head(prior_network)
```


### Map motifs to TF using Motif IDs using innerjoin:
```{r}
hg38_TFmotifs <- inner_join(human_motif, prior_network, by = "MotifID") # generate final input data for PANDA

hg38_TFmotifs <- subset(hg38_TFmotifs, select = -c(MotifID)) # drop interaction information and Motif IDs, because all interactions are present (represetned as a 1) and this information is not needed for PANDA input
write.table(hg38_TFmotifs, file = here("data/processed/motif_inputs/hg38_TFmotifs.txt"), sep = "\t") # save final input data to Cheaha for use in network construction
```

```{r}
# run style
style_file(here("src/network_scripts/input_construction/Human_PANDA_TFmotif.Rmd"))
# lintr was run as well
```

```{r}
sessionInfo()
```

