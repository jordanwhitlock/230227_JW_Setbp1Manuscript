---
title: "Setbp1_CellTypesKidney_06"
author: "Jordan Whitlock"
date: '2022-09-14'
output:     
  html_document:
      toc: true
      toc_depth: 2
      toc_float: true
---

# *Single-nuclei analysis: Identify Cell Types Kidney*
* Loading libraries
* Selecting resolution
* Investigating top markers for Kidney Cortex

## Code: 

Accompanying dry lab notebook for this analysis is here: https://docs.google.com/document/d/1FO_Je9oxbBFF9S_k-8tVF2t4ba88O4C77sw1v7DIFec/edit?usp=sharing

This analysis follows 'Setbp1_MarkersKidney_05.Rmd' and precedes "Setbp1_DGEkidney_07.Rmd"

####load in libraries:
```{r}
set.seed(2178)
library(Seurat)
library(ggplot2)
library(styler)
library(here)
library(lintr)
library(magrittr)
library(dplyr)
```

####load in markers:
```{r}
load(here("results/kidney_markers.Rdata"))
```

*also be sure that the previously generated clustered objects at resolution 0.8 are here if not loaded already, run below chunk:
```{r}
load(here("data/kidney_leiden.Rdata"))
select_resolution <- "RNA_snn_res.0.9"
kidney_int <- SetIdent(kidney_int, value = select_resolution)
```

#### identify the top25 markers for kidney :
```{r}
# top 25 kidney
kidney_top25 <- kidney_markers_genes %>%
  group_by(cluster) %>%
  top_n(-25, p_val_adj)
kidney_top25
```

#### investigate top markers and assign for kidney:
see notes on resources used to do this here as well as this paper: https://docs.google.com/document/d/1FO_Je9oxbBFF9S_k-8tVF2t4ba88O4C77sw1v7DIFec/edit?usp=sharing, https://www.science.org/doi/pdf/10.1126/science.aar2131)


##### Looking at top genes of unknown clusters in PanglaoDB
```{r}
barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 9], FALSE),
  horiz = TRUE, las = 1, main = paste0(9, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 11], FALSE),
  horiz = TRUE, las = 1, main = paste0(11, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 16], FALSE),
  horiz = TRUE, las = 1, main = paste0(16, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 22], FALSE),
  horiz = TRUE, las = 1, main = paste0(22, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 26], FALSE),
  horiz = TRUE, las = 1, main = paste0(26, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 29], FALSE),
  horiz = TRUE, las = 1, main = paste0(29, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 30], FALSE),
  horiz = TRUE, las = 1, main = paste0(30, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 31], FALSE),
  horiz = TRUE, las = 1, main = paste0(31, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 33], FALSE),
  horiz = TRUE, las = 1, main = paste0(33, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 34], FALSE),
  horiz = TRUE, las = 1, main = paste0(34, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 37], FALSE),
  horiz = TRUE, las = 1, main = paste0(37, " vs. rest"), border = "white", yaxs = "i"
)

barplot(sort(setNames(kidney_top25$avg_log2FC, kidney_top25$gene)[kidney_top25$cluster == 39], FALSE),
  horiz = TRUE, las = 1, main = paste0(39, " vs. rest"), border = "white", yaxs = "i"
)
```

##### Pericytes
```{r pericyte-features}
png(
  filename = here("results/figures/pericyte_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Pdgfrb"),
            reduction = "umap_harmony",
            label = TRUE) # clusters 9, 16, 22, 24, 33, 34
dev.off()
```

##### Endothelial
```{r endp-features}
png(
  filename = here("results/figures/endothelial_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Kdr", "Ptprb"),
            reduction = "umap_harmony",
            label = TRUE) # 1, 11, 29
dev.off()
```

##### Proximal Tubule
```{r PT-features}
png(
  filename = here("results/figures/proximaltubule_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Slc34a1", "Slc13a3"),
            reduction = "umap_harmony",
            label = TRUE) # clusters 2, 3, 5, 8, 14, 21, 23, 25
dev.off()
```

##### Proximal Straight Tubule (PST)
```{r PST-features}
png(
  filename = here("results/figures/PST_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Slc22a7", "Atp11a"),
            reduction = "umap_harmony",
            label = TRUE) # 2, 3, 4, 14, 27
dev.off()
```

##### PCT-S1
```{r PCTS1-features}
png(
  filename = here("results/figures/PCTS1_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Slc5a2", "Slc5a12"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 21, 5, 8, 23, 25
dev.off()
```

##### LOH
```{r LOH-features}
png(
  filename = here("results/figures/LOH_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Slc12a1"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 7, 6, 36, and 40
dev.off()
```

##### CD-PC
```{r CDPC-features}
png(
  filename = here("results/figures/CDPC_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Aqp2", "Hsd11b2"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 12 and 13, and 39
dev.off()
```

##### DCT
```{r DCT-features}
png(
  filename = here("results/figures/DCT_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Slc12a3"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 10
dev.off()
```

##### Macrophages
```{r macro-features}
png(
  filename = here("results/figures/macrophage_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Ptprc", "Runx1"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 15, 35, 31
dev.off()
```

##### DLH
```{r DLH-features}
png(
  filename = here("results/figures/DLH_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Bst1"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 17 and 18
dev.off()
```

##### CD-IC-A
```{r}
png(
  filename = here("results/figures/CDICA_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Aqp6"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 19
dev.off()
```

##### CD-IC-B
```{r CDICB-features}
png(
  filename = here("results/figures/CDICB_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Hmx2"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 20
dev.off()
```

##### CD-IC
```{r CDIC-features}
png(
  filename = here("results/figures/CDIC_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Atp6v1g3", "Atp6v0d2"),
            reduction = "umap_harmony",
            label = TRUE) # clusters 19 and 20
dev.off()
```

##### B lymph
```{r blymph-features}
png(
  filename = here("results/figures/blymph_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Cd79b"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 35
dev.off()
```

##### podocytes
```{r podo-features}
png(
  filename = here("results/figures/podocyte_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Nphs1", "Nphs2", "Wt1"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 28
dev.off()
```

##### vasc smooth muscle 
```{r vsmc-features}
png(
  filename = here("results/figures/vsmc_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Acta2"),
            reduction = "umap_harmony",
            label = TRUE) # cluster 24; need to subcluster it
dev.off()
```

##### Fibroblasts
```{r fibro-features}
png(
  filename = here("results/figures/fibroblast_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Pdgfra"),
            reduction = "umap_harmony",
            label = TRUE) # 9, 16, 33, 22, 33, 24, 34
dev.off()
```

##### Looking at unknown cluster 26
```{r cluster-26}
png(
  filename = here("results/figures/DLH_markers.png"),
  width = 1000,
  height = 1000
)
FeaturePlot(kidney_int,
            features = c("Akr1b3"),
            reduction = "umap_harmony",
            label = TRUE) # DLH; https://esbl.nhlbi.nih.gov/Databases/AllTranscripts/
dev.off()
```

##### Looking at unknown cluster 30
```{r cluster-30}
FeaturePlot(kidney_int,
            features = c("Ncam1", "Wt1", "Nphs1", "Nphs2"),
            reduction = "umap_harmony",
            label = TRUE) # podocytes 28 and 30, so podocytes; https://pubmed.ncbi.nlm.nih.gov/11912180/, https://www.sciencedirect.com/science/article/pii/S0002944013005853
```

##### Looking at unknown cluster 31
```{r cluster-31}
FeaturePlot(kidney_int, features = c("Ptprc", "Runx1"), reduction = "umap_harmony", label = TRUE) # macrophages
```

##### Plotting all markers
```{r plotting-final-features}
kidney_features <- c("Pdgfra", "Acta2", "Nphs1", "Nphs2", "Wt1", "Cd79b", "Hmx2", "Aqp6", "Atp6v1g3", "Atp6v0d2", "Bst1", "Runx1", "Ptprc", "Slc12a3", "Aqp2", "Hsd11b2", "Slc12a1", "Slc5a2", "Slc5a12", "Slc22a7", "Atp11a", "Slc34a1", "Slc13a3", "Kdr", "Ptprb", "Pdgfrb", "Akr1b3")

png(
  filename = here("results/figures/setbp1_kidney_markers_dotplot.png"),
  width = 1000,
  height = 1000
)
DotPlot(kidney_int, kidney_features, assay = "RNA") +
  theme_bw() + theme(legend.position = "left") +
  theme(axis.title.x = element_blank()) +
  theme(panel.grid = element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  coord_flip()
dev.off()
```




## assigning kidney cell markers

```{r assigning-markers-with-unknowns}
kidney_int_celltypes <- SetIdent(kidney_int, value = select_resolution)
kidney_int_celltypes <- RenameIdents(kidney_int,
  "1" = "endothelial",
  "2" = "PST",
  "3" = "PST",
  "4" = "PST",
  "5" = "PCT.S1",
  "6" = "LOH",
  "7" = "LOH",
  "8" = "PCT.S1",
  "9" = "fibroblasts",
  "10" = "DCT",
  "11" = "endothelial",
  "12" = "CD.PC",
  "13" = "CD.PC",
  "14" = "PST",
  "15" = "macrophages",
  "16" = "fibroblasts",
  "17" = "DLH",
  "18" = "DLH",
  "19" = "CD.IC.typeA",
  "20" = "CD.IC.typeB",
  "21" = "PCT.S1",
  "22" = "fibroblasts",
  "23" = "PCT.S1",
  "24" = "unknown1",
  "25" = "PCT.S1",
  "26" = "DLH",
  "27" = "PST",
  "28" = "podocytes",
  "29" = "endothelial",
  "30" = "podocytes",
  "31" = "macrophages",
  "32" = "PCT.S1",
  "33" = "unknown2",
  "34" = "fibroblasts",
  "35" = "B.lymphocytes",
  "36" = "LOH",
  "37" = "fibroblasts",
  "38" = "CD.PC",
  "39" = "CD.PC",
  "40" = "LOH"
)
kidney_int_celltypes <- AddMetaData(object = kidney_int_celltypes, as.vector(kidney_int_celltypes@active.ident), col.name = "cell_type")
```

```{r investigating-unknowns}
# unknown 1
subset <- subset(kidney_int_celltypes, idents = "unknown1")

p1 <- DimPlot(subset, reduction = "umap_harmony", group.by = "seurat_clusters", label = TRUE)
p1
p2 <- DimPlot(subset, reduction = "umap_harmony", group.by = "orig.ident", label = TRUE)
p2
p3 <- DimPlot(subset, reduction = "umap_harmony", group.by = "type", label = TRUE)
p3

subset <- FindNeighbors(subset, dims = 1:30, reduction = "harmony")
subset <- FindClusters(subset, graph.name = "RNA_snn", resolution = 0.2, algorithm = 4, method = "igraph")

p4 <- DimPlot(subset, reduction = "umap_harmony", group.by = "seurat_clusters", label = TRUE)
p4

FeaturePlot(subset, features = c("Pdgfrb", "Acta2", "Pdgfra"), reduction = "umap_harmony", label = TRUE) # pdgfrb is for pericytes and acta2 for vsmcs pdgfra for fibroblasts; look like all of this cluster is majority pericytes. going to assign as such

# unknown 2
subset <- subset(kidney_int_celltypes, idents = "unknown2")

p1 <- DimPlot(subset, reduction = "umap_harmony", group.by = "seurat_clusters", label = TRUE)
p1
p2 <- DimPlot(subset, reduction = "umap_harmony", group.by = "orig.ident", label = TRUE)
p2
p3 <- DimPlot(subset, reduction = "umap_harmony", group.by = "type", label = TRUE)
p3

subset <- FindNeighbors(subset, dims = 1:30, reduction = "harmony")
subset <- FindClusters(subset, graph.name = "RNA_snn", resolution = 0.2, algorithm = 4, method = "igraph")

p4 <- DimPlot(subset, reduction = "umap_harmony", group.by = "seurat_clusters", label = TRUE)
p4

FeaturePlot(subset, features = c("Pdgfrb", "Pdgfra", "Kdr", "Ptprb"), reduction = "umap_harmony", label = TRUE) # pdgfrb is for pericytes, pdgfra for fibroblasts, Kdr and Ptprb for endothelial cells; look like all of this cluster is majority endo. going to assign as such
```

```{r assigning-final-markers}
kidney_int_celltypes <- RenameIdents(kidney_int,
  "1" = "endothelial",
  "2" = "PST",
  "3" = "PST",
  "4" = "PST",
  "5" = "PCT.S1",
  "6" = "LOH",
  "7" = "LOH",
  "8" = "PCT.S1",
  "9" = "fibroblasts",
  "10" = "DCT",
  "11" = "endothelial",
  "12" = "CD.PC",
  "13" = "CD.PC",
  "14" = "PST",
  "15" = "macrophages",
  "16" = "fibroblasts",
  "17" = "DLH",
  "18" = "DLH",
  "19" = "CD.IC.typeA",
  "20" = "CD.IC.typeB",
  "21" = "PCT.S1",
  "22" = "fibroblasts",
  "23" = "PCT.S1",
  "24" = "pericytes",
  "25" = "PCT.S1",
  "26" = "DLH",
  "27" = "PST",
  "28" = "podocytes",
  "29" = "endothelial",
  "30" = "podocytes",
  "31" = "macrophages",
  "32" = "PCT.S1",
  "33" = "endothelial",
  "34" = "fibroblasts",
  "35" = "B.lymphocytes",
  "36" = "LOH",
  "37" = "fibroblasts",
  "38" = "CD.PC",
  "39" = "CD.PC",
  "40" = "LOH"
)
kidney_int_celltypes <- AddMetaData(object = kidney_int, as.vector(kidney_int_celltypes@active.ident), col.name = "cell_type")

length(unique(kidney_int_celltypes@meta.data$cell_type))

save(kidney_int_celltypes, file = here("data/kidney_integrated_celltypes.Rdata"))
```



#### Visualizing kidney data with cell types:
```{r plotting-UMAP-celltypes}
p1 <- DimPlot(kidney_int_celltypes, reduction = "umap_harmony", group.by = "type", cols = c("control" = "#FE6100", "heterozygous" = "#FFB000")) + theme(text = element_text(size = 20), legend.title = element_text(face = "bold")) + labs(color = "Condition", title = NULL)
p2 <- DimPlot(kidney_int_celltypes, reduction = "umap_harmony", group.by = "orig.ident")
p3 <- DimPlot(kidney_int_celltypes, reduction = "umap_harmony", group.by = "cell_type", cols = c("B.lymphocytes" = "#FFBE1D", "CD.IC.typeA" = "#4E3801", "CD.IC.typeB" = "#EEDF37", "CD.PC" = "#F03F00", "DCT" = "#6D0404", "DLH" = "#AA6320", "endothelial" = "#CF9400", "fibroblasts" = "#FFC8C4", "LOH" = "#AA937E", "macrophages" = "#C70F0F", "PCT.S1" = "#A85A5A", "PCT.S2" = "#F8766D", "podocytes" = "#BD085E", "PST" = "#948802")) + theme(text = element_text(size = 20), legend.title = element_text(face = "bold")) + labs(color = "kidney cell type", title = NULL)
p0 <- DimPlot(kidney_int_celltypes, reduction = "umap_harmony", group.by = "RNA_snn_res.0.9", label = TRUE, repel = TRUE)


png(
  filename = here("results/figures/kidney_setbp1_UMAP_final.png"),
  width = 1200,
  height = 600
)
p1 + p3
dev.off()

png(
  filename = here("results/figures/kidney_setbp1_UMAP_bysample.png"),
  width = 1200,
  height = 600
)
p2
dev.off()

p1
p2
p3
p0
```

```{r [plotting-nuclei-props}
png(
  filename = here("results/figures/kidney_setbp1_nuc_proportion_by_cell_condition.png"),
  width = 1200,
  height = 600
)

pt <- table(kidney_int_celltypes@meta.data$cell_type, kidney_int_celltypes@meta.data$type)
pt <- as.data.frame(pt)
pt$Var1 <- as.character(pt$Var1)
pt$Var2 <- as.character(pt$Var2)


ggplot(pt, aes(y = Var1, x = Freq, fill = Var2)) +
  geom_bar(position = "dodge", stat = "identity") +
  theme_bw(base_size = 15) +
  ylab("Cell-types") +
  xlab("Nuclei Counts") +
  scale_fill_manual(values = c("control" = "#FE6100", "heterozygous" = "#FFB000")) +
  ggtitle("Comparison of cell-type proportions across conditions") +
  # scale_fill_manual(values = brewer.pal(12, "Paired")) +
  theme(legend.title = element_blank(), axis.text.x = element_text(angle = 45))
dev.off()
```


#### plotting nuclei proportions stacked with cell type markers
```{r}
# rename pt vairable V1 to ident:
colnames(pt) <- c("ident", "Condition", "Freq")

# set plot to save
pdf(file = here("results/figures/KidneyFig2AVln.pdf"), width = 20, height = 30)

# generate plot
yy <- VlnPlot(kidney_int_celltypes,
              kidney_features,
              stack = TRUE,
              sort = FALSE,
              flip = TRUE,
              assay = "RNA",
              group.by = "cell_type",
              fill.by = "ident",
              cols = c("B.lymphocytes" = "#FFBE1D", "CD.IC.typeA" = "#4E3801", "CD.IC.typeB" = "#EEDF37", "CD.PC" = "#F03F00", "DCT" = "#6D0404", "DLH" = "#AA6320", "endothelial" = "#CF9400", "fibroblasts" = "#FFC8C4", "LOH" = "#AA937E", "macrophages" = "#C70F0F", "PCT.S1" = "#A85A5A", "PCT.S2" = "#F8766D", "podocytes" = "#BD085E", "PST" = "#948802")) +
  labs(fill = "Cell Type") +
  theme_bw() +
  theme(legend.position = "left") +
  theme(axis.text.x = element_blank()) +
  theme(axis.title.x = element_blank()) +
  theme(panel.grid = element_blank()) +
  theme(strip.text.y.right = element_text(angle = 0))


xx <- ggplot(pt, aes(x = ident, y = Freq, fill = Condition)) +
  geom_bar(position = "dodge", stat = "identity") +
  ggtitle("Kidney Cortex Cell-type Nuclei Proportions and Identity Markers") +
  theme(plot.title = element_text(hjust = 0.5)) +
  ylab("Nuclei Counts") +
  geom_text(aes(label = Freq), position = position_dodge(width = 0.9), vjust = 0.5, angle = 90, hjust = -.1) +
  scale_fill_manual(values = c("control" = "#FE6100", "heterozygous" = "#FFB000")) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(axis.text.x = element_blank()) +
  theme(axis.text.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  theme(axis.ticks = element_blank()) +
  theme(legend.position = "left")


# saving plot to outputs
xx / yy
dev.off()
```

```{r}
# set plot to save
png(file = here("results/figures/DotKidneyFig2A.png"), width = 3000, height = 2000)


pt <- table(kidney_int_celltypes@meta.data$cell_type, kidney_int_celltypes$type)
pt <- as.data.frame(pt)
pt$Var1 <- as.character(pt$Var1)

# calculate proportions
stats <- pt %>%
  group_by(Var2, Var1) %>%
  summarise(Nb = Freq) %>%
  mutate(C = sum(Nb)) %>%
  mutate(prop = Nb / C * 100)

stats$prop <- round(stats$prop, digits = 1)

colnames(stats) <- c("Condition", "Cell_type", "Nb", "C", "prop")

# generate plot
yy <- DotPlot(kidney_int_celltypes,
              unique(kidney_features),
              assay = "RNA",
              group.by = "cell_type",
              cols = c("black", "#EECB00")) +
  labs(fill = "Cell Type") +
  theme_bw() +
  theme(legend.position = "left") +
  theme(axis.title.x = element_blank()) +
  theme(panel.grid = element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  coord_flip()


xx <- ggplot(stats, aes(x = Cell_type, y = prop, fill = Condition)) +
  geom_bar(position = "dodge", stat = "identity") +
  # ggtitle("Kidney Cortex Cell-type Nuclei Proportions and Identity Markers") +
  theme(plot.title = element_text(hjust = 0.5)) +
  ylab("Nuclei Counts") +
  geom_text(aes(label = prop), position = position_dodge(width = 0.9), vjust = -0.5, angle = 0) +
  scale_fill_manual(values = c("control" = "#FE6100", "heterozygous" = "#FFB000")) +
  theme_bw() +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(axis.text.x = element_blank()) +
  theme(axis.text.y = element_blank()) +
  theme(axis.title.x = element_blank()) +
  theme(axis.ticks = element_blank()) +
  theme(legend.position = "left", plot.margin = margin(0.1))


# saving plot to outputs
xx / yy
dev.off()
```


#### rechecking out the bimodality-- seeing if bimodality is explained by cell types
```{r}
kidney_int_celltypes@meta.data %>%
  ggplot(aes(color = cell_type, x = nCount_RNA, fill = cell_type)) +
  geom_density(alpha = 0.2) +
  scale_x_log10() +
  theme_classic() +
  ylab("Cell density") +
  geom_vline(xintercept = 500)


kidney_int_celltypes@meta.data %>%
  ggplot(aes(color = cell_type, x = nFeature_RNA, fill = cell_type)) +
  geom_density(alpha = 0.2) +
  scale_x_log10() +
  theme_classic() +
  ylab("Cell density") +
  geom_vline(xintercept = 500)


kidney_int_celltypes@meta.data %>%
  ggplot(aes(color = type, x = nCount_RNA, fill = type)) +
  geom_density(alpha = 0.2) +
  scale_x_log10() +
  theme_classic() +
  ylab("Cell density") +
  geom_vline(xintercept = 500)


kidney_int_celltypes@meta.data %>%
  ggplot(aes(color = type, x = nFeature_RNA, fill = type)) +
  geom_density(alpha = 0.2) +
  scale_x_log10() +
  theme_classic() +
  ylab("Cell density") +
  geom_vline(xintercept = 500)
```

This script is followed by 'Setbp1_DGEkidney_07.Rmd'

```{r}
# run style
style_file(here("src/seurat_scripts/Setbp1_CellTypesKidney_06.Rmd"))
# lintr was run as well
```
